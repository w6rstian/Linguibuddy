<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Linguibuddy.ViewModels"
             x:Class="Linguibuddy.Views.SentenceQuizPage"
             x:DataType="vm:SentenceQuizViewModel"
             Title="Sentence Quiz"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource OffBlack}}">

    <Grid RowDefinitions="Auto, *, Auto, Auto" Padding="20" RowSpacing="20">

        <VerticalStackLayout Grid.Row="0" Spacing="10">
            <Label Text="Przetłumacz to zdanie:" 
                   FontSize="16" 
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>

            <Label Text="{Binding PolishTranslation}" 
                   FontSize="24" 
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>
        </VerticalStackLayout>

        <Border Grid.Row="1" 
                StrokeShape="RoundRectangle 12"
                StrokeThickness="1"
                Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray950}}"
                Padding="15"
                VerticalOptions="Fill">

            <FlexLayout BindableLayout.ItemsSource="{Binding SelectedWords}"
                        Wrap="Wrap"
                        Direction="Row"
                        JustifyContent="Start"
                        AlignItems="Start"
                        AlignContent="Start">

                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="vm:WordTile">
                        <Button Text="{Binding Text}"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SentenceQuizViewModel}}, Path=DeselectWordCommand}"
                                CommandParameter="{Binding .}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="{StaticResource White}"
                                CornerRadius="8"
                                HeightRequest="44"
                                Padding="15,0"
                                Margin="4"
                                FontSize="16"
                                FontAttributes="Bold">
                            <Button.Shadow>
                                <Shadow Brush="{StaticResource PrimaryBrush}" Radius="4" Opacity="0.3" Offset="2,2"/>
                            </Button.Shadow>
                        </Button>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>
        </Border>

        <Label Grid.Row="2" 
               Text="{Binding FeedbackMessage}" 
               TextColor="{Binding FeedbackColor}"
               FontSize="18"
               FontAttributes="Bold"
               HorizontalTextAlignment="Center"
               MinimumHeightRequest="30"/>

        <VerticalStackLayout Grid.Row="3" Spacing="20" VerticalOptions="End">

            <BoxView HeightRequest="1" 
                     Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"/>

            <FlexLayout BindableLayout.ItemsSource="{Binding AvailableWords}"
                        Wrap="Wrap"
                        Direction="Row"
                        JustifyContent="Center"
                        AlignItems="Center">

                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="vm:WordTile">
                        <Button Text="{Binding Text}"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SentenceQuizViewModel}}, Path=SelectWordCommand}"
                                CommandParameter="{Binding .}"
                                BackgroundColor="Transparent"
                                BorderColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                                BorderWidth="1"
                                TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                                CornerRadius="8"
                                HeightRequest="44"
                                Padding="15,0"
                                Margin="4"
                                FontSize="16"/>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>

            <Grid>
                <Button Text="Sprawdź"
                        Command="{Binding CheckAnswerCommand}"
                        IsVisible="{Binding IsNotAnswered}"  
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        HeightRequest="50"
                        CornerRadius="25"
                        FontAttributes="Bold"
                        Margin="0,10">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource PrimaryBrush}" Radius="8" Opacity="0.4" Offset="0,4"/>
                    </Button.Shadow>
                </Button>

                <Button Text="Dalej"
                        Command="{Binding NextQuestionCommand}"
                        IsVisible="{Binding IsAnswered}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        HeightRequest="50"
                        CornerRadius="25"
                        FontAttributes="Bold"
                        Margin="0,10">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource PrimaryBrush}" Radius="8" Opacity="0.4" Offset="0,4"/>
                    </Button.Shadow>
                </Button>
            </Grid>

        </VerticalStackLayout>

    </Grid>
</ContentPage>