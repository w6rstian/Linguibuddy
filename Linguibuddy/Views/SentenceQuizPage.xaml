<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:loc="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:vm="clr-namespace:Linguibuddy.ViewModels"
             xmlns:models="clr-namespace:Linguibuddy.Models"
             x:Class="Linguibuddy.Views.SentenceQuizPage"
             x:DataType="vm:SentenceQuizViewModel"
             Title="{loc:Translate SentenceQuizName}">

    <Grid>
        <VerticalStackLayout IsVisible="{Binding IsFinished}"
                             VerticalOptions="Center"
                             HorizontalOptions="Center"
                             Spacing="25">

            <Label Text="{loc:Translate Congratulations}"
                   FontSize="32"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkText}, Dark={StaticResource White}}"
                   HorizontalOptions="Center" />

            <Label Text="{loc:Translate LearningFinished}"
                   FontSize="16"
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                   HorizontalOptions="Center" />

            <Label FontSize="20"
                   FontAttributes="Bold"
                   HorizontalOptions="Center">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="{loc:Translate CorrectAnswersCount}" />
                        <Span Text=" " />
                        <Span Text="{Binding Score}" />
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <Label FontSize="16"
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                   HorizontalOptions="Center">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="{loc:Translate PointsEarnedCount}" />
                        <Span Text=" +" />
                        <Span Text="{Binding PointsEarned}" />
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <Button Text="{loc:Translate BackToList}"
                    Command="{Binding GoBackCommand}"
                    Margin="0,20,0,0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}"
                    WidthRequest="200" />
        </VerticalStackLayout>

        <Grid RowDefinitions="*, Auto" IsVisible="{Binding IsLearning}">

            <ScrollView Grid.Row="0">
                <VerticalStackLayout Spacing="20"
                                     Padding="20"
                                     MaximumWidthRequest="600"
                                     HorizontalOptions="Center">

                    <VerticalStackLayout Spacing="10" Margin="0,20,0,0">
                        <Label Text="{loc:Translate TranslateSentence}"
                               FontSize="16"
                               HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" />

                        <Label Text="{Binding PolishTranslation}"
                               FontSize="24"
                               FontAttributes="Bold"
                               HorizontalTextAlignment="Center"
                               HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                    </VerticalStackLayout>

                    <Border StrokeShape="RoundRectangle 15"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray950}}"
                            Padding="15"
                            MinimumHeightRequest="150"
                            VerticalOptions="Start">

                        <Grid>
                            <!--<Label Text="Kliknij słowa poniżej, aby ułożyć zdanie"
                                   TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"/>-->

                            <FlexLayout BindableLayout.ItemsSource="{Binding SelectedWords}"
                                        Wrap="Wrap"
                                        Direction="Row"
                                        JustifyContent="Center"
                                        AlignItems="Center"
                                        AlignContent="Center">

                                <BindableLayout.ItemTemplate>
                                    <DataTemplate x:DataType="models:WordTile">
                                        <Button Text="{Binding Text}"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SentenceQuizViewModel}}, Path=DeselectWordCommand}"
                                                CommandParameter="{Binding .}"
                                                BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                                                TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}"
                                                CornerRadius="10"
                                                HeightRequest="44"
                                                Padding="15,0"
                                                Margin="4"
                                                FontSize="16"
                                                FontAttributes="Bold">
                                            <Button.Shadow>
                                                <Shadow Brush="{AppThemeBinding Light={StaticResource PrimaryBrush}, Dark={StaticResource PrimaryDarkBrush}}" Radius="4" Opacity="0.3"
                                                        Offset="2,2" />
                                            </Button.Shadow>
                                        </Button>
                                    </DataTemplate>
                                </BindableLayout.ItemTemplate>
                            </FlexLayout>
                        </Grid>
                    </Border>

                    <Label Text="{Binding FeedbackMessage}"
                           TextColor="{Binding FeedbackColor}"
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           MinimumHeightRequest="30" />

                </VerticalStackLayout>
            </ScrollView>

            <VerticalStackLayout Grid.Row="1"
                                 Spacing="20"
                                 Padding="0,0,5,25"
                                 MaximumWidthRequest="600"
                                 HorizontalOptions="Center"
                                 VerticalOptions="End">

                <BoxView HeightRequest="1"
                         Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                         Margin="0,0,0,10" />

                <FlexLayout BindableLayout.ItemsSource="{Binding AvailableWords}"
                            Wrap="Wrap"
                            Direction="Row"
                            JustifyContent="Center"
                            AlignItems="Center">

                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:WordTile">
                            <Button Text="{Binding Text}"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SentenceQuizViewModel}}, Path=SelectWordCommand}"
                                    CommandParameter="{Binding .}"
                                    BackgroundColor="Transparent"
                                    BorderColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                                    BorderWidth="1"
                                    TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                                    CornerRadius="10"
                                    HeightRequest="44"
                                    Padding="15,0"
                                    Margin="4"
                                    FontSize="16" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>

                <Grid Margin="0,0,0,0">
                    <Button Text="{loc:Translate Check}"
                            Command="{Binding CheckAnswerCommand}"
                            IsVisible="{Binding IsNotAnswered}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}"
                            HeightRequest="50"
                            CornerRadius="25"
                            FontAttributes="Bold">
                        <Button.Shadow>
                            <Shadow Brush="{AppThemeBinding Light={StaticResource PrimaryBrush}, Dark={StaticResource PrimaryDarkBrush}}" Radius="8" Opacity="0.4" Offset="0,4" />
                        </Button.Shadow>
                    </Button>

                    <Button Text="{loc:Translate Next}"
                            Command="{Binding NextQuestionCommand}"
                            IsVisible="{Binding IsAnswered}"
                            BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                            TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}"
                            HeightRequest="50"
                            CornerRadius="25"
                            FontAttributes="Bold">
                        <Button.Shadow>
                            <Shadow Brush="{AppThemeBinding Light={StaticResource PrimaryBrush}, Dark={StaticResource PrimaryDarkBrush}}" Radius="8" Opacity="0.4" Offset="0,4" />
                        </Button.Shadow>
                    </Button>
                </Grid>

            </VerticalStackLayout>
        </Grid>
    </Grid>
</ContentPage>