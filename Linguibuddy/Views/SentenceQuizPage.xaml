<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:loc="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:vm="clr-namespace:Linguibuddy.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Linguibuddy.Views.SentenceQuizPage"
             x:DataType="vm:SentenceQuizViewModel"
             Title="Szyk zdań">

    <Grid RowDefinitions="*, Auto">

        <ScrollView Grid.Row="0">
            <VerticalStackLayout Spacing="20" 
                                 Padding="20" 
                                 MaximumWidthRequest="600" 
                                 HorizontalOptions="Center">

                <VerticalStackLayout Spacing="10" Margin="0,20,0,0">
                    <Label Text="Przetłumacz to zdanie:" 
                           FontSize="16" 
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"/>

                    <Label Text="{Binding PolishTranslation}" 
                           FontSize="24" 
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>
                </VerticalStackLayout>

                <Border StrokeShape="RoundRectangle 15"
                        StrokeThickness="1"
                        Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                        BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray950}}"
                        Padding="15"
                        MinimumHeightRequest="150"
                        VerticalOptions="Start">

                    <Grid>
                        <!--<Label Text="Kliknij słowa poniżej, aby ułożyć zdanie"
                               TextColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>-->

                        <FlexLayout BindableLayout.ItemsSource="{Binding SelectedWords}"
                                    Wrap="Wrap"
                                    Direction="Row"
                                    JustifyContent="Center"
                                    AlignItems="Center"
                                    AlignContent="Center">

                            <BindableLayout.ItemTemplate>
                                <DataTemplate x:DataType="vm:WordTile">
                                    <Button Text="{Binding Text}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SentenceQuizViewModel}}, Path=DeselectWordCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource Primary}"
                                            TextColor="{StaticResource White}"
                                            CornerRadius="10"
                                            HeightRequest="44"
                                            Padding="15,0"
                                            Margin="4"
                                            FontSize="16"
                                            FontAttributes="Bold">
                                        <Button.Shadow>
                                            <Shadow Brush="{StaticResource PrimaryBrush}" Radius="4" Opacity="0.3" Offset="2,2"/>
                                        </Button.Shadow>
                                    </Button>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                        </FlexLayout>
                    </Grid>
                </Border>

                <Label Text="{Binding FeedbackMessage}" 
                       TextColor="{Binding FeedbackColor}"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalTextAlignment="Center"
                       MinimumHeightRequest="30"/>

            </VerticalStackLayout>
        </ScrollView>

        <VerticalStackLayout Grid.Row="1" 
                             Spacing="20" 
                             Padding="20,10,20,30"
                             MaximumWidthRequest="600"
                             HorizontalOptions="Center"
                             VerticalOptions="End">

            <BoxView HeightRequest="1" 
                     Color="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}"
                     Margin="0,0,0,10"/>

            <FlexLayout BindableLayout.ItemsSource="{Binding AvailableWords}"
                        Wrap="Wrap"
                        Direction="Row"
                        JustifyContent="Center"
                        AlignItems="Center">

                <BindableLayout.ItemTemplate>
                    <DataTemplate x:DataType="vm:WordTile">
                        <Button Text="{Binding Text}"
                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:SentenceQuizViewModel}}, Path=SelectWordCommand}"
                                CommandParameter="{Binding .}"
                                BackgroundColor="Transparent"
                                BorderColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                                BorderWidth="1"
                                TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                                CornerRadius="10"
                                HeightRequest="44"
                                Padding="15,0"
                                Margin="4"
                                FontSize="16"/>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </FlexLayout>

            <Grid Margin="0,10,0,0">
                <Button Text="Sprawdź"
                        Command="{Binding CheckAnswerCommand}"
                        IsVisible="{Binding IsNotAnswered}"  
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        HeightRequest="50"
                        CornerRadius="25"
                        FontAttributes="Bold">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource PrimaryBrush}" Radius="8" Opacity="0.4" Offset="0,4"/>
                    </Button.Shadow>
                </Button>

                <Button Text="Dalej"
                        Command="{Binding NextQuestionCommand}"
                        IsVisible="{Binding IsAnswered}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="{StaticResource White}"
                        HeightRequest="50"
                        CornerRadius="25"
                        FontAttributes="Bold">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource PrimaryBrush}" Radius="8" Opacity="0.4" Offset="0,4"/>
                    </Button.Shadow>
                </Button>
            </Grid>

        </VerticalStackLayout>
    </Grid>
</ContentPage>