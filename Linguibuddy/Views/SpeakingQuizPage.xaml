<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Linguibuddy.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="Linguibuddy.Views.SpeakingQuizPage"
             x:DataType="vm:SpeakingQuizViewModel"
             Title="Wymowa">
    <Grid RowDefinitions="Auto, *, Auto, Auto" Padding="20" RowSpacing="20">

        <VerticalStackLayout Grid.Row="0" Spacing="20" VerticalOptions="Center">
            <Label Text="Przeczytaj na głos:" 
                   FontSize="18" 
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" 
                   HorizontalOptions="Center"/>

            <Border StrokeShape="RoundRectangle 20"
                    StrokeThickness="0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray950}}"
                    Padding="20"
                    HorizontalOptions="Fill">
                <VerticalStackLayout Spacing="10">
                    <Label Text="{Binding TargetSentence}" 
                           FontSize="24" 
                           FontAttributes="Bold" 
                           HorizontalTextAlignment="Center"
                           TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>

                    <Label Text="{Binding PolishTranslation}" 
                           FontSize="16" 
                           TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" 
                           HorizontalTextAlignment="Center"
                           IsVisible="{Binding PolishTranslation, Converter={toolkit:IsStringNotNullOrEmptyConverter}}"/>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>

        <VerticalStackLayout Grid.Row="1" VerticalOptions="Center" Spacing="30">

            <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">

                <Button Text="Słuchaj"
                        Command="{Binding StartListeningCommand}"
                        IsEnabled="{Binding IsNotListening}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        HeightRequest="50"
                        WidthRequest="140"
                        CornerRadius="25"
                        FontAttributes="Bold">
                    <Button.Shadow>
                        <Shadow Brush="{StaticResource Primary}" Offset="0,4" Radius="8" Opacity="0.4"/>
                    </Button.Shadow>
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsNotListening}" Value="False">
                            <Setter Property="Opacity" Value="0.5"/>
                        </DataTrigger>
                    </Button.Triggers>
                </Button>

                <Button Text="Stop"
                        Command="{Binding StopListeningCommand}"
                        IsEnabled="{Binding IsListening}"
                        BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3E2723}"
                        TextColor="#D32F2F"
                        BorderColor="#D32F2F"
                        BorderWidth="1"
                        HeightRequest="50"
                        WidthRequest="140"
                        CornerRadius="25"
                        FontAttributes="Bold">
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsListening}" Value="False">
                            <Setter Property="Opacity" Value="0.5"/>
                        </DataTrigger>
                    </Button.Triggers>
                </Button>

            </HorizontalStackLayout>

            <Label Text="{Binding RecognizedText}" 
                   FontSize="22" 
                   TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource White}}"
                   HorizontalTextAlignment="Center"
                   FontAttributes="Italic"
                   LineBreakMode="WordWrap"/>
        </VerticalStackLayout>

        <Label Grid.Row="2" 
               Text="{Binding FeedbackMessage}" 
               TextColor="{Binding FeedbackColor}"
               FontSize="18" 
               FontAttributes="Bold"
               HorizontalOptions="Center" 
               HorizontalTextAlignment="Center"
               Margin="0,0,0,10"/>

        <Button Grid.Row="3" 
                Text="Następne" 
                Command="{Binding NextQuestionCommand}"
                IsEnabled="{Binding IsAnswered}"
                BackgroundColor="{StaticResource Primary}"
                TextColor="White"
                HeightRequest="50"
                CornerRadius="25"
                FontAttributes="Bold"
                Margin="0,0,0,10">
            <Button.Triggers>
                <DataTrigger TargetType="Button" Binding="{Binding IsAnswered}" Value="False">
                    <Setter Property="Opacity" Value="0.5"/>
                </DataTrigger>
            </Button.Triggers>
        </Button>

    </Grid>
</ContentPage>