<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:loc="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:vm="clr-namespace:Linguibuddy.ViewModels"
             x:Class="Linguibuddy.Views.FlashcardsPage"
             x:DataType="vm:FlashcardsViewModel"
             Title="{Binding Collection.Name}">
    <Grid>
        <VerticalStackLayout IsVisible="{Binding IsFinished}"
                             VerticalOptions="Center" 
                             HorizontalOptions="Center" 
                             Spacing="25">

            <Border Stroke="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    StrokeThickness="2"
                    StrokeShape="RoundRectangle 50"
                    HeightRequest="100"
                    WidthRequest="100"
                    BackgroundColor="Transparent"
                    HorizontalOptions="Center">
                <Label Text="âœ”" 
                       FontSize="50" 
                       HorizontalOptions="Center" 
                       VerticalOptions="Center" 
                       TextColor="{StaticResource Primary}"/>
            </Border>

            <Label Text="{loc:Translate Congratulations}" 
                   FontSize="32" 
                   FontAttributes="Bold" 
                   TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkText}, Dark={StaticResource White}}"
                   HorizontalOptions="Center"/>

            <Label Text="{loc:Translate LearningFinished}" 
                   FontSize="16" 
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                   HorizontalOptions="Center"/>

            <Button Text="{loc:Translate BackToList}" 
                    Command="{Binding GoBackCommand}"
                    Margin="0,20,0,0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}"
                    WidthRequest="200"/>
        </VerticalStackLayout>

        <Grid RowDefinitions="*, Auto" IsVisible="{Binding IsLearning}" Margin="20">

            <VerticalStackLayout VerticalOptions="Center" Spacing="0">
                <Border x:Name="FlashcardBorder"
                        Stroke="Transparent" 
                        BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Gray950}}"
                        HeightRequest="400" 
                        WidthRequest="320"
                        StrokeShape="RoundRectangle 20">

                    <Border.Shadow>
                        <Shadow Brush="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" 
                                Offset="0,5" 
                                Radius="15" 
                                Opacity="0.1"/>
                    </Border.Shadow>

                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnCardTapped"/>
                    </Border.GestureRecognizers>

                    <Grid Padding="30">
                        <VerticalStackLayout x:Name="FrontView" 
                                             VerticalOptions="Center" 
                                             HorizontalOptions="Center" 
                                             Spacing="10"
                                             IsVisible="True">

                            <Label Text="{Binding CurrentWordText}" 
                                   FontSize="40" 
                                   FontAttributes="Bold" 
                                   TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" 
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"/>

                            <Label Text="{Binding CurrentPartOfSpeech}" 
                                   FontSize="16" 
                                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}" 
                                   HorizontalOptions="Center"
                                   TextTransform="Uppercase"/>

                            <Label Text="{loc:Translate TapToFlip}" 
                                   FontSize="12" 
                                   TextColor="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}" 
                                   HorizontalOptions="Center" 
                                   Margin="0,50,0,0"/>
                        </VerticalStackLayout>

                        <VerticalStackLayout x:Name="BackView" 
                                             VerticalOptions="Center" 
                                             HorizontalOptions="Center" 
                                             Spacing="15"
                                             IsVisible="False">

                            <Label Text="{Binding CurrentTranslation}" 
                                   FontSize="32" 
                                   FontAttributes="Bold" 
                                   TextColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDarkText}}"
                                   HorizontalOptions="Center"
                                   HorizontalTextAlignment="Center"/>

                            <BoxView HeightRequest="1" 
                                     WidthRequest="50" 
                                     Color="{StaticResource Gray200}" 
                                     HorizontalOptions="Center"/>

                            <Label Text="{Binding CurrentExample}" 
                                   FontSize="18" 
                                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray300}}" 
                                   FontAttributes="Italic" 
                                   HorizontalTextAlignment="Center"/>
                        </VerticalStackLayout>
                    </Grid>
                </Border>
            </VerticalStackLayout>

            <Grid Grid.Row="1" ColumnDefinitions="*,*" ColumnSpacing="20" Margin="0,0,0,20">

                <Button Grid.Column="0"
                        Text="{loc:Translate IDontKnow}" 
                        BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3E2723}" 
                        TextColor="#D32F2F" 
                        BorderColor="#D32F2F"
                        BorderWidth="1"
                        Command="{Binding MarkAsUnknownCommand}" 
                        Clicked="OnNextCardClicked" 
                        HeightRequest="50"
                        CornerRadius="25"
                        FontAttributes="Bold"/>

                <Button Grid.Column="1"
                        Text="{loc:Translate IKnow}" 
                        BackgroundColor="{AppThemeBinding Light=#E8F5E9, Dark=#1B5E20}" 
                        TextColor="{AppThemeBinding Light=#2E7D32, Dark=White}" 
                        BorderColor="#2E7D32"
                        BorderWidth="1"
                        Command="{Binding MarkAsKnownCommand}" 
                        Clicked="OnNextCardClicked" 
                        HeightRequest="50"
                        CornerRadius="25"
                        FontAttributes="Bold"/>
            </Grid>
        </Grid>
    </Grid>
</ContentPage>