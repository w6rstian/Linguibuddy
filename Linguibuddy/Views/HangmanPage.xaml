<?xml version="1.0" encoding="utf-8"?>

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Linguibuddy.ViewModels"
             xmlns:loc="clr-namespace:LocalizationResourceManager.Maui;assembly=LocalizationResourceManager.Maui"
             xmlns:models="clr-namespace:Linguibuddy.Models"
             x:Class="Linguibuddy.Views.HangmanPage"
             x:DataType="vm:HangmanViewModel"
             Title="{loc:Translate Hangman}">

    <Grid>
        <VerticalStackLayout
            IsVisible="{Binding IsFinished}"
            VerticalOptions="Center"
            HorizontalOptions="Center"
            Spacing="25">

            <Label
                Text="{loc:Translate Congratulations}"
                FontSize="32"
                FontAttributes="Bold"
                TextColor="{AppThemeBinding Light={StaticResource PrimaryDarkText}, Dark={StaticResource White}}"
                HorizontalOptions="Center" />

            <Label Text="{loc:Translate LearningFinished}"
                   FontSize="16"
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                   HorizontalOptions="Center" />

            <Label FontSize="20"
                   FontAttributes="Bold"
                   HorizontalOptions="Center">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="{loc:Translate CorrectAnswersCount}" />
                        <Span Text=" " />
                        <Span Text="{Binding Score}" />
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <Label FontSize="16"
                   TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource Gray400}}"
                   HorizontalOptions="Center">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="{loc:Translate PointsEarnedCount}" />
                        <Span Text=" +" />
                        <Span Text="{Binding PointsEarned}" />
                    </FormattedString>
                </Label.FormattedText>
            </Label>

            <Button Text="{loc:Translate BackToList}"
                    Command="{Binding GoBackCommand}"
                    Margin="0,20,0,0"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Primary}, Dark={StaticResource PrimaryDark}}"
                    TextColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource PrimaryDarkText}}"
                    WidthRequest="200" />
        </VerticalStackLayout>

        <Grid RowDefinitions="Auto, *, Auto, Auto" Padding="20" RowSpacing="15" IsVisible="{Binding IsLearning}">

            <Image Grid.Row="0"
                   Source="{Binding CurrentImage}"
                   HeightRequest="220"
                   Aspect="AspectFit"
                   HorizontalOptions="Center" />

            <Label Grid.Row="1"
                   Text="{Binding MaskedWord}"
                   Style="{StaticResource Headline}"
                   VerticalOptions="Center"
                   HorizontalOptions="Fill"
                   CharacterSpacing="4" />

            <Label Grid.Row="2"
                   Text="{Binding FeedbackMessage}"
                   TextColor="{Binding FeedbackColor}"
                   FontSize="20"
                   FontAttributes="Bold"
                   HorizontalTextAlignment="Center" />

            <VerticalStackLayout Grid.Row="3" Spacing="20">

                <BoxView HeightRequest="1" Color="{StaticResource Gray200}" />

                <FlexLayout BindableLayout.ItemsSource="{Binding Keyboard}"
                            Wrap="Wrap"
                            JustifyContent="Center"
                            AlignItems="Center"
                            Direction="Row">

                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:HangmanLetter">
                            <Button Text="{Binding Character}"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HangmanViewModel}}, Path=GuessLetterCommand}"
                                    CommandParameter="{Binding .}"
                                    IsEnabled="{Binding IsEnabled}"
                                    BackgroundColor="{Binding BackgroundColor}"
                                    BorderColor="{Binding BorderColor}"
                                    TextColor="{Binding TextColor}"
                                    BorderWidth="1"
                                    WidthRequest="44"
                                    HeightRequest="44"
                                    Margin="4"
                                    Padding="0"
                                    CornerRadius="8"
                                    FontSize="18"
                                    FontAttributes="Bold" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>

                <Button Text="{loc:Translate NextWord}"
                        Command="{Binding NextGameCommand}"
                        IsVisible="{Binding IsAnswered}"
                        HorizontalOptions="Fill" />

            </VerticalStackLayout>

            <ActivityIndicator Grid.RowSpan="4"
                               IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="Center" VerticalOptions="Center" />
        </Grid>
    </Grid>
</ContentPage>